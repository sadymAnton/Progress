
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	ДанныеПрисоединенногоФайла = ПолучитьДанныеПрисоединенногоФайлаПакетаНаСервере(ПараметрКоманды);
	СтатусНеизвестногоПакета   = ПредопределенноеЗначение("Перечисление.СтатусыПакетовЭД.Неизвестный");
	ОбменЧерезОператора        = ПредопределенноеЗначение("Перечисление.СпособыОбменаЭД.ЧерезОператораЭДОТакском");
	Если НЕ ДанныеПрисоединенногоФайла.СтатусПакета = СтатусНеизвестногоПакета
			И ДанныеПрисоединенногоФайла.СпособОбменаЭД = ОбменЧерезОператора
			И НЕ Найти(ДанныеПрисоединенногоФайла.ОтправительЭД, "2AL") > 0 Тогда
		Возврат;
	КонецЕсли;
	
	ДанныеФайла = ПрисоединенныеФайлыСлужебныйВызовСервера.ПолучитьДанныеФайла(ДанныеПрисоединенногоФайла.ПрисоединенныйФайл,
		ПараметрыВыполненияКоманды.Источник.УникальныйИдентификатор);
	
	ДанныеФайлаДляСохранения = Новый Структура;
	ДанныеФайлаДляСохранения.Вставить("Расширение", ДанныеФайла.Расширение);
	ДанныеФайлаДляСохранения.Вставить("ПолноеНаименование", ДанныеФайла.Наименование);
	ДанныеФайлаДляСохранения.Вставить("АдресХранилища", ДанныеФайла.СсылкаНаДвоичныеДанныеФайла);
	
	ЭлектронныеДокументыКлиент.СохранитьКак(ДанныеФайлаДляСохранения);
	
КонецПроцедуры

&НаСервере
Функция ПолучитьДанныеПрисоединенногоФайлаПакетаНаСервере(ПакетЭД)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЭДПрисоединенныеФайлы.Ссылка,
	|	ЭДПрисоединенныеФайлы.ВладелецФайла.СпособОбменаЭД КАК СпособОбменаЭД,
	|	ЭДПрисоединенныеФайлы.ВладелецФайла.Отправитель КАК Отправитель,
	|	ЭДПрисоединенныеФайлы.ВладелецФайла.СтатусПакета КАК СтатусПакета
	|ИЗ
	|	Справочник.ЭДПрисоединенныеФайлы КАК ЭДПрисоединенныеФайлы
	|ГДЕ
	|	ЭДПрисоединенныеФайлы.ВладелецФайла = &ВладелецФайла";
	
	Запрос.УстановитьПараметр("ВладелецФайла", ПакетЭД);
	
	РезультатЗапроса = Запрос.Выполнить().Выбрать();
	РезультатЗапроса.Следующий();
	
	СтруктураДанныхПакета = Новый Структура;
	СтруктураДанныхПакета.Вставить("ПрисоединенныйФайл", РезультатЗапроса.Ссылка);
	СтруктураДанныхПакета.Вставить("ОтправительЭД",      РезультатЗапроса.Отправитель);
	СтруктураДанныхПакета.Вставить("СтатусПакета",       РезультатЗапроса.СтатусПакета);
	СтруктураДанныхПакета.Вставить("СпособОбменаЭД",     РезультатЗапроса.СпособОбменаЭД);
	
	Возврат СтруктураДанныхПакета;
	
КонецФункции
