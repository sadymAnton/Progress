//начало изменений Ожиганов А. б/н добавление загрузки резервов по ЭТК  29.11.2016 
Перем мУдалятьДвижения;
//конец изменений 
Процедура ОбработкаПроведения(Отказ, Режим)

	//начало изменений Ожиганов А. б/н добавление загрузки резервов по ЭТК  29.11.2016 
		Если мУдалятьДвижения Тогда
			Движения.ПРГ_БюджетЭТК.Записывать = Истина;
			Движения.ПРГ_БюджетЭТК.Очистить();
			
			Движения.ПРГ_РезервыЭТК.Записывать = Истина;
			Движения.ПРГ_РезервыЭТК.Очистить();
			
		КонецЕсли;
	//конец изменений 

	//начало изменений Ожиганов А. б/н добавление загрузки резервов по ЭТК  29.11.2016 
	Если ВидОперации = Перечисления.ПРГ_ВидыОперацийЗагрузкиБюджетаИРезервовЭТК.ЗагрузкаБюджетЭТК Тогда
	//конец изменений 
		// регистр ПРГ_БюджетЭТК 
		Движения.ПРГ_БюджетЭТК.Записывать = Истина;
		Движения.ПРГ_БюджетЭТК.Очистить();
		Для Каждого ТекСтрокаБюджет Из Бюджет Цикл
			Движение = Движения.ПРГ_БюджетЭТК.Добавить();
			Движение.Период = Дата;
			Движение.Организация = Организация;
			Движение.ПериодПлана = ТекСтрокаБюджет.ПериодПлана;
			Движение.Контрагент = ТекСтрокаБюджет.Контрагент;
			Движение.Сумма = ТекСтрокаБюджет.Сумма;
		КонецЦикла;
	//начало изменений Ожиганов А. б/н добавление загрузки резервов по ЭТК  29.11.2016 	
	Иначе 
		
		ПРГ_РезервыЭТКНЗ = Движения.ПРГ_РезервыЭТК;
		ПРГ_РезервыЭТКНЗ.Записывать = Истина;
		ПРГ_РезервыЭТКНЗ.Очистить();
		
		Для Каждого ТекСтрока Из Резервы Цикл
			Движение 			    = ПРГ_РезервыЭТКНЗ.Добавить();
			Движение.Период			= Дата;       
			Движение.ПериодРезерва = ТекСтрока.ПериодРезерва;
			Движение.Дивизион      = ТекСтрока.Дивизион;
			Движение.ДопОфис   	   = ТекСтрока.ДопОфис;
			Движение.Дистрибьютор  = ТекСтрока.Дистрибьютор;
			Движение.Контрагент    = ТекСтрока.Контрагент;
			Движение.Сумма		   = ТекСтрока.Сумма;
		КонецЦикла;
	КонецЕсли;	
	//конец изменений 
КонецПроцедуры

//начало изменений Ожиганов 29.11.2016 б/н изменение на печать pdf 
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	// Вставить содержимое обработчика.
	мУдалятьДвижения = НЕ ЭтоНовый();	
	Если НЕ ЗначениеЗаполнено(ВидОперации) Тогда
	 	ВидОперации = Перечисления.ПРГ_ВидыОперацийЗагрузкиБюджетаИРезервовЭТК.ЗагрузкаБюджетЭТК;
	КонецЕслИ;	
КонецПроцедуры


Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	// Вставить содержимое обработчика.
	Если Не ЗначениеЗаполнено(ВидОперации) или  
		ВидОперации = Перечисления.ПРГ_ВидыОперацийЗагрузкиБюджетаИРезервовЭТК.ЗагрузкаБюджетЭТК Тогда
		ПроверяемыеРеквизиты.Добавить("Бюджет.ПериодПлана");
		ПроверяемыеРеквизиты.Добавить("Бюджет.Контрагент");
	Иначе
		ПроверяемыеРеквизиты.Добавить("Резервы.ПериодРезерва");
		ПроверяемыеРеквизиты.Добавить("Резервы.Дивизион");
		ПроверяемыеРеквизиты.Добавить("Резервы.ДопОфис");
		ПроверяемыеРеквизиты.Добавить("Резервы.Дистрибьютор");
		ПроверяемыеРеквизиты.Добавить("Резервы.Контрагент");
	КонецЕсли;
КонецПроцедуры
//конец изменений  
                                                                