#Если ТолстыйКлиентОбычноеПриложение Тогда

// Процедура устанавливыет нужную страницу панели ПанельВыбораИндексирования обработки индексации заработка
//
// Параметры
//  ЭлементыФормы  - Коллекция ллементов формы обработки
//
Процедура УстановитьСтраницуОсновнойПанели(ЭлементыФормы) Экспорт

	ЭлементыФормы.ПанельВыбораИндексирования.ТекущаяСтраница = ЭлементыФормы.ПанельВыбораИндексирования.Страницы.Страница1;
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Организации.ПометкаУдаления КАК ПометкаУдаления
	|ИЗ
	|	Справочник.Организации КАК Организации";
	Выборка = Запрос.Выполнить().Выбрать();
	ЭлементыФормы.ПанельИсторияОднаОрганизация.Видимость = (Выборка.Количество() = 1);
	Если Выборка.Количество() = 1 Тогда
		ЭлементыФормы.Страница1ВыбранноеДействие2.Заголовок = "Отмена последнего повышения окладов";
	КонецЕсли;
	
КонецПроцедуры // УстановитьСтраницуПанельВыбораИндексирования()

// Функция определяет вид договора сотрудников для индексации окладов
//
Функция ПолучитьВидДоговораПоДействиюИндексации(ФормаОбработки) Экспорт

	Возврат Перечисления.ВидыДоговоровСФизЛицами.ТрудовойДоговор;

КонецФункции // ИндексацияЗаработкаПереопределяемый.ПолучитьВидДоговораПоДействиюИндексации()

Функция ПолучитьОписаниеИндексацииДолжностныеОклады(ВидДоговора = Неопределено) Экспорт

	ТекстЗаголовка = "Повышение должностных окладов сотрудников";
	Возврат ТекстЗаголовка;

КонецФункции // ПолучитьОписаниеИндексацииДолжностныеОклады()

Функция ПолучитьОписаниеИндексацииПоСтрокеИстории(ДанныеСтроки) Экспорт

	Период = ДанныеСтроки.ДатаПовышения;
	ТекстСообщения = "На дату: " + Формат(Период, "ДФ=dd.MM.yyyy") + " зарегистрировано повышение:";
	Если ДанныеСтроки.ДолжностныеОклады Тогда
		ТекстСообщения = ТекстСообщения + Символы.ПС + " - должностных окладов";
	КонецЕсли;	
	Если ДанныеСтроки.ШтатноеРасписание Тогда
		ТекстСообщения = ТекстСообщения + Символы.ПС + " - окладов штатного расписания";
	КонецЕсли;	
	Если ДанныеСтроки.ТарифныеРазряды Тогда
		ТекстСообщения = ТекстСообщения + Символы.ПС + " - окладов по тарифным разрядам";
	КонецЕсли;
	
	Возврат ТекстСообщения;

КонецФункции // ПолучитьОписаниеИндексацииПоСтрокеИстории()

Процедура УстановитьКолонкиТаблицыШтатноеРасписание(ЭлементыФормыШтатноеРасписание) Экспорт
	
	ЭлементыФормыШтатноеРасписание.Колонки.МесячнаяСтавка1.ТекстШапки = "Минимальная тарифная ставка";
	ЭлементыФормыШтатноеРасписание.Колонки.МесячнаяСтавка2.ТекстШапки = "Максимальная тарифная ставка";
	ЭлементыФормыШтатноеРасписание.Колонки.НоваяМесячнаяСтавка1.ТекстШапки = "Новая минимальная тарифная ставка";
	ЭлементыФормыШтатноеРасписание.Колонки.НоваяМесячнаяСтавка2.ТекстШапки = "Новая максимальная тарифная ставка";

КонецПроцедуры

Процедура ОформитьТабличноеПолеДопТарифныеРазряды(ТабличноеПолеДопТарифныеРазряды) Экспорт

	//
	
КонецПроцедуры // ОформитьТабличноеПолеДопТарифныеРазряды()

Функция ОписаниеДопРазряда() Экспорт

	Возврат "";

КонецФункции // ОписаниеДопРазряда()

	
#КонецЕсли

//////////////////////////////////////////////////////////
// Штатное расписание

Функция ПолучитьТекстЗапросаДляШтатногоРасписания() Экспорт

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ШтатноеРасписаниеСрезПоследних.Период,
	|	ШтатноеРасписаниеСрезПоследних.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	|	ШтатноеРасписаниеСрезПоследних.Должность,
	|	ШтатноеРасписаниеСрезПоследних.КоличествоСтавок,
	|	ШтатноеРасписаниеСрезПоследних.ВидТарифнойСтавки,
	|	ШтатноеРасписаниеСрезПоследних.ГрафикРаботы,
	|	ШтатноеРасписаниеСрезПоследних.ВалютаТарифнойСтавки,
	|	ШтатноеРасписаниеСрезПоследних.ОсобыеУсловияТруда,
	|	ШтатноеРасписаниеСрезПоследних.МинимальнаяТарифнаяСтавка КАК МесячнаяСтавка1,
	|	0 КАК НоваяМесячнаяСтавка1,
	|	ШтатноеРасписаниеСрезПоследних.МаксимальнаяТарифнаяСтавка КАК МесячнаяСтавка2,
	|	0 КАК НоваяМесячнаяСтавка2,
	|	ВЫБОР
	|		КОГДА ШтатноеРасписаниеСрезПоследних.Период = &ДатаПовышения
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЕстьОшибки,
	|	ШтатноеРасписаниеСрезПоследних.ПодразделениеОрганизации.Наименование КАК ПодразделениеОрганизацииНаименование,
	|	ШтатноеРасписаниеСрезПоследних.Должность.Наименование КАК ДолжностьНаименование
	|ИЗ
	|	РегистрСведений.ШтатноеРасписаниеОрганизаций.СрезПоследних(&ДатаПовышения, ПодразделениеОрганизации.Владелец = &Организация) КАК ШтатноеРасписаниеСрезПоследних
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПодразделениеОрганизацииНаименование,
	|	ДолжностьНаименование";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаДляШтатногоРасписания()

Функция ПолучитьТекстЗапросаДляСравненияШтатногоРасписания() Экспорт

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ШтатноеРасписаниеСрезПоследних.Период,
	|	ШтатноеРасписаниеСрезПоследних.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	|	ШтатноеРасписаниеСрезПоследних.Должность КАК Должность,
	|	ВЫБОР
	|		КОГДА (НЕ ШтатноеРасписаниеНовое.Период ЕСТЬ NULL )
	|			ТОГДА ШтатноеРасписаниеНовое.НоваяМесячнаяСтавка1
	|		ИНАЧЕ ШтатноеРасписаниеСрезПоследних.МинимальнаяТарифнаяСтавка
	|	КОНЕЦ КАК МесячнаяСтавка1,
	|	ВЫБОР
	|		КОГДА (НЕ ШтатноеРасписаниеНовое.Период ЕСТЬ NULL )
	|			ТОГДА ШтатноеРасписаниеНовое.НоваяМесячнаяСтавка2
	|		ИНАЧЕ ШтатноеРасписаниеСрезПоследних.МаксимальнаяТарифнаяСтавка
	|	КОНЕЦ КАК МесячнаяСтавка2,
	|	ИСТИНА КАК УчитыватьСтавку2
	|ПОМЕСТИТЬ ВТШтатноеРасписание
	|ИЗ
	|	РегистрСведений.ШтатноеРасписаниеОрганизаций.СрезПоследних(&ДатаПовышения, ПодразделениеОрганизации.Владелец = &Организация) КАК ШтатноеРасписаниеСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТШтатноеРасписаниеНовое КАК ШтатноеРасписаниеНовое
	|		ПО ШтатноеРасписаниеСрезПоследних.ПодразделениеОрганизации = ШтатноеРасписаниеНовое.ПодразделениеОрганизации
	|			И ШтатноеРасписаниеСрезПоследних.Должность = ШтатноеРасписаниеНовое.Должность";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаДляСравненияШтатногоРасписания()

Функция ПолучитьТекстЗапросаДляИсторииШтатногоРасписания() Экспорт

	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ШтатноеРасписаниеОрганизаций.Период КАК Период,
	|	ШтатноеРасписаниеОрганизаций.ПодразделениеОрганизации КАК ПодразделениеОрганизации,
	|	ШтатноеРасписаниеОрганизаций.Должность КАК Должность,
	|	ШтатноеРасписаниеОрганизаций.МинимальнаяТарифнаяСтавка КАК МесячнаяСтавка1,
	|	ШтатноеРасписаниеОрганизаций.МаксимальнаяТарифнаяСтавка КАК МесячнаяСтавка2
	|ПОМЕСТИТЬ ВТШтатноеРасписание
	|ИЗ
	|	РегистрСведений.ШтатноеРасписаниеОрганизаций КАК ШтатноеРасписаниеОрганизаций
	|ГДЕ
	|	ШтатноеРасписаниеОрганизаций.ПодразделениеОрганизации.Владелец = &Организация
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПодразделениеОрганизации,
	|	Должность";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаДляИсторииШтатногоРасписания()

Функция ПолучитьТаблицуДляЗаписиШтаногоРасписания(ОбработкаОбъект) Экспорт

	ТаблицаШтатногоРасписания = ОбработкаОбъект.ШтатноеРасписание.Выгрузить();
	ТаблицаШтатногоРасписания.Колонки.НоваяМесячнаяСтавка1.Имя = "МинимальнаяТарифнаяСтавка";
	ТаблицаШтатногоРасписания.Колонки.НоваяМесячнаяСтавка2.Имя = "МаксимальнаяТарифнаяСтавка";
	
	Возврат ТаблицаШтатногоРасписания;


КонецФункции // ПолучитьТаблицуДляЗаписиШтаногоРасписания()


 //////////////////////////////////////////////////////////
// Тарифные и пр. разряды

Функция ПолучитьТекстЗапросаДляТарифныхРазрядов() Экспорт

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	РазмерТарифныхСтавокСрезПоследних.ТарифныйРазряд,
	|	РазмерТарифныхСтавокСрезПоследних.Размер,
	|	РазмерТарифныхСтавокСрезПоследних.Валюта,
	|	ВЫБОР
	|		КОГДА РазмерТарифныхСтавокСрезПоследних.Период = &ДатаПовышения
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЕстьОшибки,
	|	0 КАК НовыйРазмер,
	|	РазмерТарифныхСтавокСрезПоследних.ТарифныйРазряд.Наименование КАК ТарифныйРазрядНаименование
	|ИЗ
	|	РегистрСведений.РазмерТарифныхСтавок.СрезПоследних(&ДатаПовышения, ) КАК РазмерТарифныхСтавокСрезПоследних
	|
	|УПОРЯДОЧИТЬ ПО
	|	ТарифныйРазрядНаименование";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаДляШтатногоРасписания()


Функция ПолучитьТаблицуИсторииДопТарифныхРазрядов(ДатаПовышения = Неопределено, Период = Неопределено, ВернутьСписокТарифныхРазрядов = Ложь) Экспорт
	
	Возврат Новый ТаблицаЗначений;

КонецФункции // ПолучитьТаблицуИсторииДопТарифныхРазрядов()

Функция ПолучитьТекстЗапросаКоличествоПовышенийТарифнойСетки() Экспорт

	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	КОЛИЧЕСТВО(РазмерТарифныхСтавок.Период) КАК Количество
	|ПОМЕСТИТЬ ВТКоличествоТарифныхСтавок
	|ИЗ
	|	РегистрСведений.РазмерТарифныхСтавок.СрезПоследних(&ДатаПовышения, ) КАК РазмерТарифныхСтавок
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодыТарифныхРазрядов.Период,
	|	КОЛИЧЕСТВО(ПериодыТарифныхРазрядов.ТарифныйРазряд) КАК Количество
	|ПОМЕСТИТЬ ВТПериодыПовышения
	|ИЗ
	|	ВТПериодыТарифныхРазрядов КАК ПериодыТарифныхРазрядов
	|
	|СГРУППИРОВАТЬ ПО
	|	ПериодыТарифныхРазрядов.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТПериодыПовышения.Период КАК ДатаПовышения
	|ИЗ
	|	ВТПериодыПовышения КАК ВТПериодыПовышения
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТКоличествоТарифныхСтавок КАК КоличествоТарифныхСтавок
	|		ПО (ИСТИНА)
	|ГДЕ
	|	ВТПериодыПовышения.Количество >= КоличествоТарифныхСтавок.Количество / 2";
	
	Возврат ТекстЗапроса;

КонецФункции // ПолучитьТекстЗапросаКоличествоПовышенийТарифнойСетки()

Функция ПолучитьПолеВладелецЗапросаПериодыТарифныхРазрядов() Экспорт

	Возврат "Неопределено КАК Владелец";

КонецФункции // ПолучитьПолеВладелецЗапросаПериодыТарифныхРазрядов()

Функция ПолучитьУсловиеЗапросаПериодыТарифныхРазрядов() Экспорт

	Возврат "";

КонецФункции // ПолучитьУсловиеЗапросаПериодыТарифныхРазрядов()

Функция ПолучитьТекстЗапросаДляДопТарифныхРазрядов() Экспорт

	Возврат "";

КонецФункции

Функция ЗарегистрироватьИзмененияДопТарифныхРазрядов(ДопТарифныеРазряды, ДатаПовышения) Экспорт

	Возврат Истина;

КонецФункции // ЗарегистрироватьИзмененияДопТарифныхРазрядов()

Функция ОтменитьПовышениеДопТарифныхРазрядов(ДатаОтмены) Экспорт

	Возврат Истина;
	
КонецФункции // ОтменитьПовышениеШтатноеРасписание()





