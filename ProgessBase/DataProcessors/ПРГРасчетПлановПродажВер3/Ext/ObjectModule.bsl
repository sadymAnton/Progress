Функция ПосчитатьСуммуГруппы(ВидБазы,НайденныеСтрокиДляРаспределения,Итоги,ИсключитьФильтрПоПроектуИТоварнойКатегории=Ложь) Экспорт 

	тСуммаГросс = 0;
	
	//Посчитаем сумму ГРОСС группы
	Для каждого СтрТЧ Из НайденныеСтрокиДляРаспределения Цикл
		
		Если ИсключитьФильтрПоПроектуИТоварнойКатегории Тогда
			
			СтруктураПоиска = Новый Структура("Период,Дивизион,КатегорияКлиента,Вывеска,Брендообъем"
				,СтрТЧ.Период,Справочники.ПРГДивизионы.ПустаяСсылка(),Справочники.НСИ_КатегорииКлиентов.ПустаяСсылка()
				,Справочники.НСИ_Вывески.ПустаяСсылка(),Справочники.НСИ_Брендообъемы.ПустаяСсылка()
				);
			
		Иначе
			
			СтруктураПоиска = Новый Структура("Период,Дивизион,КатегорияКлиента,Вывеска,Брендообъем,Проект,ТоварнаяКатегория"
				,СтрТЧ.Период,Справочники.ПРГДивизионы.ПустаяСсылка(),Справочники.НСИ_КатегорииКлиентов.ПустаяСсылка()
				,Справочники.НСИ_Вывески.ПустаяСсылка(),Справочники.НСИ_Брендообъемы.ПустаяСсылка()
				,Справочники.ПРГ_ПроектыГП.ПустаяСсылка(),Справочники.НСИ_ТоварныеКатегории.ПустаяСсылка()
				);
			
		КонецЕсли; 
		
		
		Если ЗначениеЗаполнено(СтрТЧ.Дивизион) Тогда
			СтруктураПоиска.Вставить("Дивизион",СтрТЧ.Дивизион);
		КонецЕсли; 		
		Если ЗначениеЗаполнено(СтрТЧ.КатегорияКлиента) Тогда
			СтруктураПоиска.Вставить("КатегорияКлиента",СтрТЧ.КатегорияКлиента);
		КонецЕсли; 
		Если ЗначениеЗаполнено(СтрТЧ.Вывеска) Тогда
			СтруктураПоиска.Вставить("Вывеска",СтрТЧ.Вывеска);
		КонецЕсли; 
		Если НЕ ИсключитьФильтрПоПроектуИТоварнойКатегории И ЗначениеЗаполнено(СтрТЧ.Проект) Тогда
			СтруктураПоиска.Вставить("Проект",СтрТЧ.Проект);
		КонецЕсли;
		Если НЕ ИсключитьФильтрПоПроектуИТоварнойКатегории И ЗначениеЗаполнено(СтрТЧ.ТоварнаяКатегория) Тогда
			СтруктураПоиска.Вставить("ТоварнаяКатегория",СтрТЧ.ТоварнаяКатегория);
		КонецЕсли;
		
		НайденныеСтрокиИтоги = Итоги.НайтиСтроки(СтруктураПоиска);
		
		Если НайденныеСтрокиИтоги.Количество()>0 И НайденныеСтрокиИтоги[0][ВидБазы] > 0 Тогда
			тСуммаГросс = тСуммаГросс + НайденныеСтрокиИтоги[0][ВидБазы]; 	
		КонецЕсли; 
		
	КонецЦикла;

	Возврат тСуммаГросс;
	
КонецФункции

Процедура РасчитаемСуммуБонусов(ВидБонуса,ВидБазы,НайденныеСтрокиДляРаспределения,РезультатРасчета,тСуммаБазыГруппы,тПоказательГруппы,ИсключитьФильтрПоПроектуИТоварнойКатегории=Ложь) Экспорт

	//Расчитаем сумму ретробонусов
	Для каждого СтрТЧ Из НайденныеСтрокиДляРаспределения Цикл
		
		СтруктураПоиска2 = Новый Структура("Период",СтрТЧ.Период);
		
		Если ЗначениеЗаполнено(СтрТЧ.Дивизион) Тогда
			СтруктураПоиска2.Вставить("Дивизион",СтрТЧ.Дивизион);
		КонецЕсли; 		
		Если ЗначениеЗаполнено(СтрТЧ.КатегорияКлиента) Тогда
			СтруктураПоиска2.Вставить("КатегорияКлиента",СтрТЧ.КатегорияКлиента);
		КонецЕсли; 
		Если ЗначениеЗаполнено(СтрТЧ.Вывеска) Тогда
			СтруктураПоиска2.Вставить("Вывеска",СтрТЧ.Вывеска);
		КонецЕсли; 
		Если НЕ ИсключитьФильтрПоПроектуИТоварнойКатегории И ЗначениеЗаполнено(СтрТЧ.Проект) Тогда
			СтруктураПоиска2.Вставить("Проект",СтрТЧ.Проект);
		КонецЕсли;
		Если НЕ ИсключитьФильтрПоПроектуИТоварнойКатегории И ЗначениеЗаполнено(СтрТЧ.ТоварнаяКатегория) Тогда
			СтруктураПоиска2.Вставить("ТоварнаяКатегория",СтрТЧ.ТоварнаяКатегория);
		КонецЕсли;
		
		НайденныеСтроки = РезультатРасчета.НайтиСтроки(СтруктураПоиска2);
		
		Для каждого ТекСтр Из НайденныеСтроки Цикл
			ТекСтр[ВидБонуса] = ТекСтр[ВидБонуса] + ТекСтр[ВидБазы] / тСуммаБазыГруппы * тПоказательГруппы; 	
		КонецЦикла; 
		
	КонецЦикла;

КонецПроцедуры
 

